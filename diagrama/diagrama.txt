---
config:
  layout: elk
---
classDiagram
    direction LR
    title Diagrama de Classes Final e Detalhado - Simulador de Hidr√¥metro
    class main {
        +main() int
    }
    class SHA {
        -unique_ptr~IprovedorConfig~ m_provedor
        -unique_ptr~GeradorImagemPNG~ m_gerador_imagem
        -unique_ptr~controladora~ m_controladora
        -unique_ptr~cronometro~ m_cronometro
        -unique_ptr~Tela~ m_tela
        -mutex m_mutex
        +SHA(caminho_config: const string&)
        +~SHA()
        +run() void
    }
    class controladora {
        -simuladorHidrometro* sim
        -GeradorImagemPNG* ger_imagem
        -mutex* m_mutex
        +controladora(prov, gerador, mutex)
        +~controladora()
        +executar(sec: double, scale: double) void
        +gerar_imagem() void
        +criar_simulador(prov: const IprovedorConfig&) void
    }
    class cronometro {
        -Icomando* cmd
        -int intervalo_ms
        -double scala_simulador
        -thread worker_thread
        -atomic~bool~ ativo
        +cronometro(cmd, intervalo, scala)
        +~cronometro()
        +iniciar() void
        +parar() void
        -loop() void
    }
    class Tela {
        -RenderWindow m_janela
        -Texture m_textura
        -unique_ptr~Sprite~ m_sprite
        -string m_caminho_imagem
        -mutex* m_mutex
        +Tela(largura, altura, titulo, path, mutex)
        +executar() void
        -processarEventos() void
        -renderizar() void
    }
    class Icomando {
        <<Interface>>
        +executar(sec, scale)* void
    }
    class IprovedorConfig {
        <<Interface>>
        +enviar_configuracoes()* configuracoes_t
        +montar_configuracoes()* void
    }
    class simuladorHidrometro {
        -double consumo_m3
        -int consumo_centena_l
        -int consumo_dezena_l
        -int consumo_litro
        -tubo* tubo_entrada
        -tubo* tubo_saida
        +simuladorHidrometro(t_entrada, t_saida)
        +~simuladorHidrometro()
        +atualizar_info(sec, scale) void
        +get_consumo_total_m3() double
        +get_consumo_litro() int
    }
    class tubo {
        -double diametro
        -double vazao_agua
        -double vazao_ar
        +tubo(diametro, vazao_agua, vazao_ar)
        +consumo_em_dlitros() double
    }
    class fabrica {
        +criar_simulador(prov)* simuladorHidrometro*
    }
    class GeradorImagemPNG {
        -int largura
        -int altura
        -vector~unsigned char~ buffer_pixels
        +GeradorImagemPNG(largura, altura)
        +gerar(sim, path) void
        -desenhar_pixel(x, y, cor) void
        -desenhar_retangulo(x, y, w, h, cor) void
        -desenhar_circulo_preenchido() void
        -desenhar_digito() void
        -desenhar_texto() void
        -desenhar_linha() void
        -desenhar_imagem() void
    }
    class provedorConfigArquivo {
        -configuracoes_t configuracoes
        -string file_name
        -ifstream file
        +provedorConfigArquivo(name)
        +enviar_configuracoes() configuracoes_t
        +montar_configuracoes() void
    }
    class configuracoes_t {
        <<Struct>>
        +double vazao_entrada
        +double diametro_entrada
        +double ar_entrada
        +double vazao_saida
        +double diametro_saida
        +double ar_saida
        +double tempo
        +double scale
    }
    main ..> SHA : cria_e_executa
    SHA "1" *-- "1" controladora
    SHA "1" *-- "1" cronometro
    SHA "1" *-- "1" Tela
    SHA "1" *-- "1" GeradorImagemPNG
    SHA "1" *-- "1" IprovedorConfig
    Icomando <|.. controladora
    IprovedorConfig <|.. provedorConfigArquivo
    cronometro --> "1" Icomando : executa
    controladora *-- "1" simuladorHidrometro : possui
    controladora --> GeradorImagemPNG : usa
    controladora ..> fabrica : usa_para_criar
    simuladorHidrometro "1" *-- "2" tubo : possui
    fabrica ..> IprovedorConfig : usa
    fabrica ..> tubo : cria
    fabrica ..> simuladorHidrometro : cria
    provedorConfigArquivo ..> configuracoes_t : preenche
    GeradorImagemPNG ..> simuladorHidrometro : le_estado
    Tela ..> imagem.png : le_do_ficheiro
